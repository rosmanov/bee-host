BuildRoot:      %_topdir/@CPACK_PACKAGE_FILE_NAME@@CPACK_RPM_PACKAGE_COMPONENT_PART_PATH@
Summary:        Native Messaging Host for the Bee Browser Extension
Name:           @CPACK_PACKAGE_NAME@
Version:        @CPACK_PACKAGE_VERSION@
Release:        @CPACK_PACKAGE_RELEASE@
License:        @PROJECT_LICENSE@
Group:          Development/Tools/Other
Prefix:         @CPACK_PACKAGING_INSTALL_PREFIX@

%define _rpmdir @CMAKE_CURRENT_BINARY_DIR@/_CPack_Packages/Linux/RPM
%define _rpmfilename @CPACK_PACKAGE_FILE_NAME@.rpm
%define _unpackaged_files_terminate_build 0
%define _topdir @CMAKE_CURRENT_BINARY_DIR@/_CPack_Packages/Linux/RPM

@TMP_RPM_URL@
@TMP_RPM_REQUIRES@
@TMP_RPM_REQUIRES_PRE@
@TMP_RPM_REQUIRES_POST@
@TMP_RPM_REQUIRES_PREUN@
@TMP_RPM_REQUIRES_POSTUN@
@TMP_RPM_PROVIDES@
@TMP_RPM_OBSOLETES@
@TMP_RPM_CONFLICTS@
@TMP_RPM_SUGGESTS@
@TMP_RPM_AUTOPROV@
@TMP_RPM_AUTOREQ@
@TMP_RPM_AUTOREQPROV@
@TMP_RPM_BUILDARCH@
@TMP_RPM_PREFIXES@

@TMP_RPM_DEBUGINFO@

%define _rpmdir %_topdir/RPMS
%define _srcrpmdir %_topdir/SRPMS
@FILE_NAME_DEFINE@
%define _unpackaged_files_terminate_build 0
@TMP_RPM_SPEC_INSTALL_POST@
@CPACK_RPM_SPEC_MORE_DEFINE@
@CPACK_RPM_COMPRESSION_TYPE_TMP@

%description
Native messaging host application for "Browser's Exernal Editor" Chrome/Firefox
extension (https://github.com/rosmanov/chrome-bee).

%prep
mv $RPM_BUILD_ROOT %_topdir/tmpBBroot
rm -rf "$RPM_BUILD_DIR/CMakeFiles"
rm -f "$RPM_BUILD_DIR/CMakeCache.txt"

%build

%install
if [ -e $RPM_BUILD_ROOT ];
then
  rm -rf $RPM_BUILD_ROOT
fi
mv %_topdir/tmpBBroot $RPM_BUILD_ROOT

target_path="$RPM_BUILD_ROOT/@BEECTL_MANIFEST_TARGET_PATH@"

# Host application
install -D -m 755 "@CMAKE_CURRENT_BINARY_DIR@/@CPACK_PACKAGE_NAME@" "$target_path"

install -D -m 644 @CMAKE_CURRENT_BINARY_DIR@/@BEECTL_CHROME_MANIFEST_DIR@/com.ruslan_osmanov.bee.json \
    "$RPM_BUILD_ROOT/@BEECTL_CHROME_MANIFEST_DIR@/com.ruslan_osmanov.bee.json"

install -D -m 644 @CMAKE_CURRENT_BINARY_DIR@/@BEECTL_FIREFOX_MANIFEST_DIR@/com.ruslan_osmanov.bee.json \
    "$RPM_BUILD_ROOT/@BEECTL_FIREFOX_MANIFEST_DIR@/com.ruslan_osmanov.bee.json"

@TMP_RPM_DEBUGINFO_INSTALL@

%clean

%post
@RPM_SYMLINK_POSTINSTALL@
@CPACK_RPM_SPEC_POSTINSTALL@

%postun
@CPACK_RPM_SPEC_POSTUNINSTALL@

%pre
@CPACK_RPM_SPEC_PREINSTALL@

%preun
@CPACK_RPM_SPEC_PREUNINSTALL@

%files
%defattr(-,root,root,-)
# Host application
@BEECTL_MANIFEST_TARGET_PATH@
# Chrome manifest
/@BEECTL_CHROME_MANIFEST_DIR@/com.ruslan_osmanov.bee.json
# Firefox manifest
/@BEECTL_FIREFOX_MANIFEST_DIR@/com.ruslan_osmanov.bee.json

%changelog
* Sun Mar 12 2023 @PROJECT_CONTACT@ 1.3.6-1
- Added -h and --help CLI arguments.
- Updated cJSON library version to v1.7.15.
* Wed Oct 05 2022 @PROJECT_CONTACT@ 1.3.5-1
- Install Firefox manifest into /usr/lib64 instead of /usr/lib
  on 64-bit platforms.
* Thu Apr 07 2022 @PROJECT_CONTACT@ 1.3.4-1
- Fixed trailing character truncation in the temporary file path when editor
  was obtained from TMPDIR on non-Windows platforms.
* Sun Sep 21 2021 @PROJECT_CONTACT@ 1.3.3-1
- Fixed #5: command line arguments were not escaped properly in Windows.
* Wed Dec 30 2020 @PROJECT_CONTACT@ 1.3.1-1
- Fixed double free (thanks to TÃ©rence Clastres)
* Sat Aug 15 2020 @PROJECT_CONTACT@ 1.2.0-1
- Added support for custom filename extension via "ext" JSON property
- Fixed potential double free and a leak
- Miscellaneous tiny improvements of development files
* Sat Nov 02 2019 @PROJECT_CONTACT@ 1.1.4-1
* Fri Jan 11 2019 @PROJECT_CONTACT@ 1.0.0-1
- First release

@TMP_OTHER_COMPONENTS@
